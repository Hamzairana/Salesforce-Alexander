<template>
  <article class="slds-card slds-card_boundary">
    <div class="slds-page-header slds-theme_shade">
      <div class="slds-page-header__row">
        <div class="slds-page-header__col-title">
          <div class="slds-media">
            <div class="slds-media__figure">
              <span class="slds-icon_container">
                <lightning-icon icon-name="action:view_relationship" alternative-text="New Relationship"
                  title="New Relationship" size="xx-small" style="border-radius: 13%; margin-left:10px;">
                </lightning-icon>
              </span>
            </div>
            <div class="slds-media__body">
              <div class="slds-page-header__name">
                <div class="slds-page-header__name-title">
                  <template if:true={maxContactsToDisplay}>
                    <span class="slds-page-header__title slds-truncate slds-m-top_xx-small" title="Contacts">Active
                      Contacts (6+)</span>
                  </template>
                  <template if:false={maxContactsToDisplay}>
                    <span class="slds-page-header__title slds-truncate slds-m-top_xx-small" title="Contacts">Active
                      Contacts ({activeContactsCount})</span>
                  </template>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="slds-page-header__col-actions">
          <div class="slds-page-header__controls">
            <button style="cursor: pointer;" name="refreshButton" title="Refresh" type="button" class="slds-button slds-button_icon 
                slds-button_icon-border slds-m-right_xx-small" onclick={refreshPage}>
              <svg focusable="false" data-key="refresh" aria-hidden="true" class="slds-button__icon">
                <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg?cache=9.37.1#refresh"></use>
              </svg>
              <span class="slds-assistive-text">Refresh</span>
            </button>
            <div class="slds-page-header__control">
              <lightning-button label="New" title="New" onclick={navigateToNewRecordPage}
                class="slds-m-right_small slds-float_right">
              </lightning-button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <template if:true={areDetailsVisible}>
      <div class="slds-card__body slds-card__body_inner">
        <div class="slds-grid slds-wrap slds-var-p-left_x-small slds-box_small" style="padding: 0px;">
          <template for:each={activeContacts} for:item="contacts">
            <div class="slds-card__body slds-card__body_inner slds-col slds-size_4-of-12 slds-var-m-bottom_small"
              style="padding: 10px;" key={contacts.Id}>
              <ul>
                <li>
                  <article class="slds-tile slds-media slds-card__tile slds-hint-parent">
                    <div class="slds-media__figure">
                      <span class="slds-icon_container slds-icon-standard-contact"
                        title="Description of icon when needed">
                        <lightning-icon icon-name="standard:contact" alternative-text="Contact" title="Contact">
                        </lightning-icon>
                      </span>
                    </div>
                    <div class="slds-media__body">
                      <div class="slds-grid slds-grid_align-spread slds-has-fleSxi-truncate">
                        <h3 class="slds-tile__title slds-truncate">
                          <lightning-tile label={contacts.Name} value={contacts.Id} href={contacts.href}>
                          </lightning-tile>
                        </h3>
                        <lightning-button-menu alternative-text="Show menu" menu-alignment="auto" icon-size="x-small">
                          <lightning-menu-item label="Edit" data-id={contacts.Id} title="Edit Contact"
                            onclick={navigateToEditContactPage}>
                          </lightning-menu-item>
                          <lightning-menu-item label="Delete" data-id={contacts.Id} title="Delete Contact"
                            onclick={openDeleteModal}>
                          </lightning-menu-item>
                        </lightning-button-menu>
                        <span class="slds-assistive-text">More options</span>
                      </div>
                      <div class="slds-tile__detail">
                        <dl class="slds-list_horizontal slds-wrap">
                          <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Account Name">
                            Account Name:
                          </dt>
                          <dd class="slds-item_detail slds-truncate" title={contacts.Account.Name}>
                            {contacts.Account.Name}
                          </dd>
                          <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Title">
                            Title:
                          </dt>
                          <dd class="slds-item_detail slds-truncate" title={contacts.Title}>
                            {contacts.Title}
                          </dd>
                          <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Email">
                            Email:
                          </dt>
                          <dd class="slds-item_detail slds-truncate" title={contacts.Email}>
                            {contacts.Email}
                          </dd>
                          <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Phone">
                            Phone:
                          </dt>
                          <dd class="slds-item_detail slds-truncate" title={contacts.Phone}>
                            {contacts.Phone}
                          </dd>

                          <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Direct">
                            Direct:
                          </dt>
                          <dd class="slds-item_detail slds-truncate" title={contacts.Direct__c}>
                            <lightning-input type="checkbox" checked={contacts.Direct__c} disabled> 
                              
                            </lightning-input>
                          </dd>
                        </dl>
                      </div>
                    </div>
                  </article>
                </li>
              </ul>
            </div>

          </template>
        </div>
      </div>
      <!-- Card Body Ends Here -->
      <!-- Footer Starts here -->
      <template if:true={footerComponent}>
        <footer class="slds-card__footer">
          <a class="slds-card__footer-action" href={viewAllLink} target="_blank">View All
            <span class="slds-assistive-text">View All Contacts</span>
          </a>
        </footer>
      </template>
      <!-- Footer Ends here -->
    </template>
  </article>
  <!-- Template for delete modal -->
  <template if:true={deleteModal}>
    <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
      class="slds-modal slds-fade-in-open">
      <div class="slds-modal__container">
        <lightning-button-icon icon-name="utility:close" alternative-text="Close this window" size="large"
          variant="bare-inverse" onclick={closeDeleteModal} class="slds-modal__close">
        </lightning-button-icon>
        <span class="slds-assistive-text">Cancel and close</span>
        <div class="slds-modal__header">
          <h1 class="slds-modal__title slds-hyphenate">
            Delete Contact
          </h1>
        </div>

        <div class="slds-modal__content slds-p-around_medium slds-text-align_center">
          Are you sure you want to delete this Contact?
        </div>
        <div class="slds-modal__footer">
          <div class="slds-clearfix">
            <div class="slds-float_right">
              <ul class="slds-button-group-row">
                <li class="slds-button-group-item">
                  <button class="slds-button slds-button_outline-brand" onclick={closeDeleteModal}>
                    Cancel
                  </button>
                </li>
                <li class="slds-button-group-item slds-p-left_x-small">
                  <lightning-button class="slds-m-top_small" variant="brand" type="submit" name="delete" label="Delete"
                    onclick={deleteActiveContact}>
                  </lightning-button>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
  </template>
  <!-- Template for delete modal -->
</template>